(function(e){function t(t){for(var i,o,s=t[0],c=t[1],l=t[2],d=0,h=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={app:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},"5c0b":function(e,t,n){"use strict";var i=n("7694"),r=n.n(i);r.a},"61c3":function(e,t,n){},6261:function(e,t,n){},7694:function(e,t,n){},"7a4c":function(e,t,n){"use strict";var i=n("6261"),r=n.n(i);r.a},a9b3:function(e,t,n){"use strict";var i=n("61c3"),r=n.n(i);r.a},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},a=[],o=n("d4ec"),s=n("262e"),c=n("2caf"),l=n("9ab4"),u=n("2fe1"),d=function(e){Object(s["a"])(n,e);var t=Object(c["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return n}(i["a"]);d=Object(l["c"])([u["b"]],d);var h=d,f=h,v=(n("5c0b"),n("2877")),p=Object(v["a"])(f,r,a,!1,null,null,null),m=p.exports,g=n("9483");Object(g["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("5363");var b=n("8c4f"),y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",dark:""}},[n("v-toolbar-title",[n("v-icon",{staticClass:"mx-3"},[e._v("mdi-weather-lightning")]),[e._v("Thunder Class 雷课堂")]],2)],1),n("v-content",[n("v-row",{staticClass:"fill-height align-center justify-center"},[n("v-card",{staticClass:"pr-4 pb-4 pl-4",attrs:{"max-width":"100%",width:"400px"}},[n("v-form",{ref:"form",staticClass:"text-center",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[n("v-tabs",{staticClass:"mb-6",attrs:{centered:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[n("v-tab",{attrs:{to:"/new"}},[e._v("创建")]),n("v-tab",{attrs:{to:"/join"}},[e._v("加入")])],1),n("v-text-field",{staticClass:"mb-2",attrs:{counter:20,rules:e.nickNameRules,clearable:"",hint:"必填。",label:"输入昵称",outlined:"","persistent-hint":"","prepend-inner-icon":"mdi-pencil-outline",tabindex:"1"},model:{value:e.nickName,callback:function(t){e.nickName=t},expression:"nickName"}}),"/join"===e.type?n("v-text-field",{key:0,staticClass:"mb-2",attrs:{counter:10,rules:e.roomIdRules,clearable:"",hint:"必填。",label:"填写要加入的房间号",outlined:"","persistent-hint":"","prepend-inner-icon":"mdi-cube-outline",tabindex:"2"},on:{blur:function(t){e.roomId=e.roomId.replace(/\D/g,"")}},model:{value:e.roomId,callback:function(t){e.roomId=t},expression:"roomId"}}):e._e(),"/new"===e.type?n("div",{staticClass:"mb-4 grey--text text--darken-2 caption"},[e._v(" 房间号稍后将自动生成 ")]):e._e(),n("v-btn",{attrs:{disabled:!e.connected,loading:!e.connected,color:"blue darken-4",large:"",tabindex:"3",type:"submit"}},[e._v(" 进入课堂 ")])],1)],1)],1)],1)],1)},S=[],k=(n("a15b"),n("ac1f"),n("5319"),n("bee2")),w=(n("4160"),n("4ec9"),n("b64b"),n("d3b7"),n("3ca3"),n("159b"),n("ddb0"),n("8055")),x=n.n(w),V=n("ba10"),_=n.n(V),j={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},O="wss://service.thunder.zkllab.com",C=x()(O),T=new _.a,D=new Map,L=new Map,$=new Map,R=new Map,A=null,E=null,B=null,M=null,N=!1,P=null,I=!1;function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";"production"!==Object({NODE_ENV:"production",BASE_URL:"/"}).node_env&&console.info(e,t)}function z(e){var t=new RTCPeerConnection(j);return t.ontrack=function(t){if(F("ontrack",t),"video"===t.track.kind)P=e,B=new MediaStream([t.track]),T.emit("screen_stream"),T.emit("screen_sid");else if("audio"===t.track.kind){var n=new MediaStream([t.track]);R.set(e,n),T.emit("audio_start")}},t.onicecandidate=function(t){F("onicecandidate",t),t.candidate&&C.emit("ice_candidate",{candidate:t.candidate,to:e})},t.onnegotiationneeded=function(){F("onnegotiationneeded"),t.createOffer().then((function(n){t.setLocalDescription(n).then((function(){C.emit("offer",{sdp:t.localDescription,to:e})}))}))},$.set(e,t),t}function W(e){return[[e[30].x,e[30].y],[e[8].x,e[8].y],[e[36].x,e[36].y],[e[45].x,e[45].y],[e[48].x,e[48].y],[e[54].x,e[54].y]]}C.on("connect",(function(){F("connect"),I=!0,T.emit("connect")})),C.on("ice_candidate",(function(e){F("ice_candidate",e);var t=$.get(e.sid);e.candidate&&null!=t&&t.addIceCandidate(e.candidate).catch((function(e){return console.error(e)}))})),C.on("offer",(function(e){F("offer",e);var t=$.get(e.sid);null!=t&&t.setRemoteDescription(e.sdp).then((function(){t.createAnswer().then((function(n){t.setLocalDescription(n).then((function(){C.emit("answer",{sdp:t.localDescription,to:e.sid})}))}))}))})),C.on("answer",(function(e){F("answer",e);var t=$.get(e.sid);null!=t&&t.setRemoteDescription(e.sdp).then((function(){return console.log("ice candidate added: ".concat(e.sid))}))})),C.on("join",(function(e){F("join",e),M=e.roomId,N=null!=e.screen,T.emit("screen_sharing"),D.clear(),Object.keys(e.members).forEach((function(t){if(D.set(t,e.members[t]),!$.has(t)&&t!==C.id){var n=z(t);null!=A&&A.getTracks().forEach((function(e){n.addTrack(e)})),null!=E&&E.getTracks().forEach((function(e){n.addTrack(e)}))}})),T.emit("join",e),T.emit("members")})),C.on("facing_preview",(function(e){F("facing_preview",e),T.emit("facing_preview",e)})),C.on("facing",(function(e){F("facing",e),T.emit("facing",e)})),C.on("end_audio",(function(e){F("end_audio",e),T.emit("end_audio",e)})),C.on("video",(function(e){F("video",e),L.clear(),Object.keys(e).forEach((function(t){L.set(t,e[t])})),T.emit("videos")})),C.on("screen",(function(e){F("screen",e),N=null!=e.sid,T.emit("screen_sharing"),null!=e.sid&&e.sid===C.id&&$.forEach((function(e){null!=E&&E.getTracks().forEach((function(t){e.addTrack(t)}))}))})),C.on("leave",(function(e){F("leave",e),D.clear(),Object.keys(e.members).forEach((function(t){D.set(t,e.members[t])})),$.forEach((function(t,n){n in e.members||(t.close(),$.delete(n))})),T.emit("leave",e),T.emit("members")})),C.on("disconnect",(function(){F("disconnect"),I=!1,T.emit("disconnect")}));var H={on:function(e,t){return T.on(e,t)},off:function(e,t){return T.off(e,t)},once:function(e,t){return T.once(e,t)},isConnected:function(){return I},isScreenSharing:function(){return N},getSid:function(){return C.id},getAudioBuffer:function(){return R},getRoomId:function(){return M},getMembers:function(){return D},getVideos:function(){return L},getScreenStream:function(){return B},getScreenSid:function(){return P},join:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(I){var n={nickName:e};null!=t&&(n.roomId=t),C.emit("join",n)}},facingPreview:function(e,t,n){if(I){var i=function(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5)},r={points:W(e),width:t,height:n,faceSize:i(e[2],e[14])};C.emit("facing_preview",r)}},facing:function(e,t,n){if(I){var i=null!=e?{points:W(e),width:t,height:n}:{};C.emit("facing",i)}},startAudio:function(e){A=e,$.forEach((function(t){e.getTracks().forEach((function(e){t.addTrack(e)}))}))},endAudio:function(){A=null,C.emit("end_audio")},startVideo:function(e){var t={character:e};C.emit("start_video",t)},endVideo:function(){C.emit("end_video")},startScreenShare:function(e){E=e,C.emit("start_screen_sharing")},stopScreenShare:function(){E=null,C.emit("stop_screen_sharing")}},U=function(e){Object(s["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.type="/join",e.nickName="",e.roomId="",e.connected=!1,e.nickNameRules=[function(e){return!!e||"昵称是必填的！"},function(e){return e&&e.length<=20||"昵称不能超过20个字符！"},function(e){return e&&!(/^\s/.test(e)||/\s$/.test(e))||"昵称首尾不能为空白字符！"},function(e){return e&&!/\s{2,}/.test(e)||"昵称不能有连续的空白字符！"}],e.roomIdRules=[function(e){return!!e||"房间号是必填的，如需创建新教室请点击“创建”！"},function(e){return e&&/^(?:\D*\d\D*){10}$/.test(e)||"房间号需为10位数字，当前格式或位数不符！"}],e}return Object(k["a"])(n,[{key:"mounted",value:function(){var e=this.$route.query.id;"string"===typeof e&&e&&/^\d{10}$/.test(e)&&(this.roomId=e),H.on("connect",this.handleConnectedChanged),H.on("disconnect",this.handleConnectedChanged),this.handleConnectedChanged()}},{key:"beforeDestroy",value:function(){H.off("connect",this.handleConnectedChanged),H.off("disconnect",this.handleConnectedChanged)}},{key:"handleConnectedChanged",value:function(){this.connected=H.isConnected()}},{key:"submit",value:function(){var e=this;this.$refs.form.validate()&&("/join"===this.type?H.join(this.nickName,this.roomId):H.join(this.nickName),H.once("join",(function(t){e.$router.replace("/".concat(t.roomId))})))}}]),n}(i["a"]);U=Object(l["c"])([u["b"]],U);var q=U,J=q,G=n("6544"),K=n.n(G),Q=n("7496"),X=n("40dc"),Y=n("8336"),Z=n("b0af"),ee=n("a75b"),te=n("4bd4"),ne=n("132d"),ie=n("0fd9"),re=n("71a3"),ae=n("fe57"),oe=n("8654"),se=n("2a7f"),ce=Object(v["a"])(J,y,S,!1,null,null,null),le=ce.exports;K()(ce,{VApp:Q["a"],VAppBar:X["a"],VBtn:Y["a"],VCard:Z["a"],VContent:ee["a"],VForm:te["a"],VIcon:ne["a"],VRow:ie["a"],VTab:re["a"],VTabs:ae["a"],VTextField:oe["a"],VToolbarTitle:se["a"]});var ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-content",[n("video",{directives:[{name:"show",rawName:"v-show",value:null!=e.screenSharingStream||e.screenSharing,expression:"screenSharingStream != null || screenSharing"}],ref:"screenVideo",staticClass:"screen-video",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),n("video",{ref:"realSelfVideo",staticClass:"real-self-video",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),n("div",{staticClass:"members-list"},e._l(e.membersList,(function(t){return n("div",{key:t.sid,staticClass:"member"},[null!=t.character?n("Live2D",{ref:t.sid+"-live2d",refInFor:!0,staticClass:"member-live2d",attrs:{height:48,type:t.character,width:150}}):e._e(),n("v-chip",{staticClass:"member-chip",attrs:{color:t.color,ripple:""},on:{click:function(n){return e.refreshLive2d(t.sid)}}},[n("v-avatar",{staticClass:"member-chip__avatar",attrs:{color:t.colorDark,left:""}},[t.audio?n("v-icon",{attrs:{size:16}},[e._v("mdi-microphone")]):n("v-icon",{attrs:{size:16}},[e._v("mdi-microphone-off")])],1),n("v-avatar",{staticClass:"member-chip__avatar",attrs:{color:t.colorDark,left:""}},[null!=t.character?n("v-icon",{attrs:{size:16}},[e._v("mdi-video-outline")]):n("v-icon",{attrs:{size:16}},[e._v("mdi-video-off-outline")])],1),n("span",{staticClass:"member-chip__nick-name"},[e._v(e._s(t.nickName))])],1),n("audio",{ref:t.sid+"-audio",refInFor:!0,attrs:{autoplay:""}})],1)})),0)]),n("v-bottom-navigation",{attrs:{app:"",value:"null"},model:{value:e.navValue,callback:function(t){e.navValue=t},expression:"navValue"}},[null==e.audioStream?n("v-btn",{attrs:{disabled:e.audioBusy,loading:e.audioBusy,value:"audio"},on:{click:e.startAudio}},[[e._v("解除静音")],n("v-icon",[e._v("mdi-microphone-off")])],2):n("v-btn",{attrs:{color:"indigo",value:"stopAudio"},on:{click:e.stopAudio}},[[e._v("静 音")],n("v-icon",[e._v("mdi-microphone")])],2),null==this.realVideoStream?n("v-dialog",{attrs:{"max-width":"640"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[n("v-btn",e._g({attrs:{loading:e.modelLoading||e.videoBusy,value:"video"},on:{click:e.prepareVideo}},i),[[e._v("开启视频")],n("v-icon",[e._v("mdi-video-off")])],2)]}}],null,!1,628551132),model:{value:e.videoDialogVisible,callback:function(t){e.videoDialogVisible=t},expression:"videoDialogVisible"}},[n("v-card",[n("v-card-title",{staticClass:"subtitle-1"},[n("v-icon",{staticClass:"mr-2"},[e._v("mdi-help-circle-outline")]),e._v(" 今天你想用什么形象呢？ ")],1),n("v-card-text",{staticClass:"pb-0"},[n("v-row",{attrs:{align:"end"}},[n("v-col",{attrs:{cols:5}},[n("v-responsive",{attrs:{"aspect-ratio":16/9}},[n("canvas",{directives:[{name:"show",rawName:"v-show",value:null!=e.videoStream,expression:"videoStream != null"}],ref:"selfVideoOverlay",staticClass:"self-video self-video-overlap",attrs:{height:"180",width:"320"}}),n("video",{directives:[{name:"show",rawName:"v-show",value:null!=e.videoStream,expression:"videoStream != null"}],ref:"selfVideo",staticClass:"self-video",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),null==e.videoStream?n("v-row",{staticClass:"fill-height grey darken-3",attrs:{align:"center",justify:"center"}},[n("v-icon",{attrs:{color:"grey darken-2"}},[e._v("mdi-video-off-outline")])],1):e._e()],1)],1),n("v-col",{attrs:{cols:6}},[e.videoDialogVisible&&null!=e.selfLive2DType?n("Live2D",{ref:"previewLive2D",attrs:{height:150,type:e.selfLive2DType,width:300,"show-refresh":""}}):e._e()],1),n("v-col",{attrs:{cols:1}},[n("v-row",{attrs:{dense:""}},[n("v-col",{attrs:{cols:12}},[n("v-btn",{staticClass:"float-right",attrs:{fab:"",small:""},on:{click:e.changeCharacter}},[n("v-icon",[e._v("mdi-account-convert")])],1)],1),n("v-col",{attrs:{cols:12}},[n("v-btn",{staticClass:"float-right",attrs:{fab:"",small:""},on:{click:e.changeTexture}},[n("v-icon",[e._v("mdi-tshirt-crew-outline")])],1)],1)],1)],1)],1)],1),n("v-card-actions",{staticClass:"pr-4 pb-4 pl-4"},[n("v-spacer"),n("v-btn",{attrs:{small:"",text:""},on:{click:function(t){e.videoDialogVisible=!1}}},[e._v("取消")]),n("v-btn",{attrs:{color:"primary",small:"",text:""},on:{click:e.startVideo}},[e._v("就是TA了!")])],1)],1)],1):n("v-btn",{attrs:{color:"blue",value:"stopVideo"},on:{click:e.stopRealVideo}},[[e._v("停止视频")],n("v-icon",[e._v("mdi-video")])],2),null==e.screenSharingStream?n("v-btn",{attrs:{disabled:e.screenSharing,loading:e.screenSharingBusy,value:"screen"},on:{click:e.startScreenSharing}},[[e._v("共享屏幕")],n("v-icon",[e._v("mdi-monitor-screenshot")])],2):n("v-btn",{attrs:{color:"green",value:"screen"},on:{click:e.stopScreenSharing}},[[e._v("停止共享")],n("v-icon",[e._v("mdi-monitor-screenshot")])],2),n("v-spacer"),n("v-dialog",{attrs:{"max-width":"290"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[n("v-btn",e._g({attrs:{value:"leave"}},i),[[e._v("离开课堂")],n("v-icon",[e._v("mdi-exit-run")])],2)]}}]),model:{value:e.leaveDialogVisible,callback:function(t){e.leaveDialogVisible=t},expression:"leaveDialogVisible"}},[n("v-card",[n("v-card-title",{staticClass:"subtitle-1"},[n("v-icon",{staticClass:"mr-2"},[e._v("mdi-help-circle-outline")]),e._v(" 确定要离开课堂吗？ ")],1),n("v-card-actions",{staticClass:"pr-4 pb-4 pl-4 pt-2"},[n("v-spacer"),n("v-btn",{attrs:{small:"",text:""},on:{click:function(t){e.leaveDialogVisible=!1}}},[e._v("取消")]),n("v-btn",{attrs:{color:"red",small:"",text:""},on:{click:e.reload}},[e._v("离开课堂")])],1)],1)],1),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{active:"",value:"null"}})],1)],1)},de=[],he=(n("6062"),n("96cf"),n("1da1")),fe=n("60a3"),ve=n("ab39"),pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"live2d",style:e.live2dStyle},[n("div",{staticClass:"wrapper",style:e.wrapperStyle},[e.refreshing?e._e():n("iframe",{ref:"iframe",style:e.iframeStyle,attrs:{src:"/live2d.html?m="+e.m+"&t="+e.t,sandbox:"allow-same-origin allow-scripts",seamless:""}})]),e.showRefresh?n("v-btn",{staticClass:"refresh-btn",attrs:{fab:"","x-small":""},on:{click:e.refresh}},[n("v-icon",[e._v("mdi-refresh")])],1):e._e()],1)},me=[],ge=(n("a9e3"),n("1276"),n("3835")),be="1-0",ye=function(e){Object(s["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.m=0,e.t=0,e.refreshing=!1,e.active=!0,e}return Object(k["a"])(n,[{key:"onTypeChanged",value:function(e){this.parseType(e)}},{key:"created",value:function(){this.parseType(this.type||be)}},{key:"parseType",value:function(e){var t=e.split("-"),n=Object(ge["a"])(t,2),i=n[0],r=n[1];this.m=parseInt(i,10),this.t=parseInt(r,10)}},{key:"setPoint",value:function(e,t){this.refreshing||null==this.$refs.iframe||this.$refs.iframe.contentWindow.dragMgr&&this.$refs.iframe.contentWindow.dragMgr.setPoint(e,t)}},{key:"refresh",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.refreshing=!0,e.next=3,this.$nextTick();case 3:setTimeout((function(){t.refreshing=!1}));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setActive",value:function(e){this.active=e}},{key:"live2dStyle",get:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),opacity:this.active?"1":"0.5"}}},{key:"wrapperStyle",get:function(){return{top:"-".concat((this.width||0)-(this.height||0),"px"),width:"".concat(this.width,"px"),height:"".concat(this.width,"px")}}},{key:"iframeStyle",get:function(){return{transform:"scale(".concat((this.width||0)/400,")")}}}]),n}(i["a"]);Object(l["c"])([Object(fe["a"])({type:String,default:be})],ye.prototype,"type",void 0),Object(l["c"])([Object(fe["a"])({type:Number,default:400})],ye.prototype,"width",void 0),Object(l["c"])([Object(fe["a"])({type:Number,default:150})],ye.prototype,"height",void 0),Object(l["c"])([Object(fe["a"])({type:Boolean,default:!1})],ye.prototype,"showRefresh",void 0),Object(l["c"])([Object(fe["b"])("type")],ye.prototype,"onTypeChanged",null),ye=Object(l["c"])([u["b"]],ye);var Se=ye,ke=Se,we=(n("a9b3"),Object(v["a"])(ke,pe,me,!1,null,"8b21edf0",null)),xe=we.exports;K()(we,{VBtn:Y["a"],VIcon:ne["a"]});n("99af");var Ve="https://api.zsq.im/live2d";function _e(){return je.apply(this,arguments)}function je(){return je=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,i,r,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"0-0",n=t.split("-")[0],e.next=4,fetch("".concat(Ve,"/rand/?id=").concat(n));case 4:return i=e.sent,e.next=7,i.json();case 7:return r=e.sent,e.abrupt("return","".concat(r.model.id,"-0"));case 9:case"end":return e.stop()}}),e)}))),je.apply(this,arguments)}function Oe(){return Ce.apply(this,arguments)}function Ce(){return Ce=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,i,r,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"0-0",n=t.split("-")[0],e.next=4,fetch("".concat(Ve,"/rand_textures/?id=").concat(t));case 4:return i=e.sent,e.next=7,i.json();case 7:return r=e.sent,e.abrupt("return","".concat(n,"-").concat(r.textures.id));case 9:case"end":return e.stop()}}),e)}))),Ce.apply(this,arguments)}var Te=function(e){Object(s["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.modelLoading=!0,e.navValue="null",e.audioBusy=!1,e.audioStream=null,e.videoBusy=!1,e.videoStream=null,e.realVideoStream=null,e.screenSharing=!1,e.screenSharingBusy=!1,e.screenSharingStream=null,e.screenSharingSid=null,e.videoDialogVisible=!1,e.leaveDialogVisible=!1,e.selfLive2DType=null,e.members=new Map,e.audios=new Set,e.videos=new Map,e.membersListTrigger=1,e}return Object(k["a"])(n,[{key:"reload",value:function(){window.location.reload()}},{key:"onNavigationValueChanged",value:function(e){var t=this;"null"!==e&&this.$nextTick((function(){setTimeout((function(){t.navValue="null"}))}))}},{key:"onVideoDialogVisibleChanged",value:function(e){e||this.stopVideo()}},{key:"mounted",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(H.getRoomId()===this.$route.params.id){e.next=10;break}if(!/^\d{10}$/.test(this.$route.params.id)){e.next=6;break}return e.next=4,this.$router.replace("/join?id=".concat(encodeURIComponent(this.$route.params.id)));case 4:e.next=8;break;case 6:return e.next=8,this.$router.replace("/join");case 8:e.next=31;break;case 10:return e.next=12,Promise.all([ve["d"]("./models"),ve["c"]("./models")]);case 12:return this.modelLoading=!1,e.next=15,this.changeCharacter();case 15:return this.handleMembers(),H.on("members",this.handleMembers),e.next=19,this.$nextTick();case 19:this.handleAudioStart(),H.on("audio_start",this.handleAudioStart),this.handleVideos(),H.on("videos",this.handleVideos),this.handleScreenStream(),H.on("screen_stream",this.handleScreenStream),this.handleScreenSharing(),H.on("screen_sharing",this.handleScreenSharing),this.handleScreenSharingSid(),H.on("screen_sid",this.handleScreenSharingSid),H.on("facing",this.handleFacing),H.on("end_audio",this.handleAudioEnd);case 31:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){H.off("members",this.handleMembers),H.off("audio_start",this.handleAudioStart),H.off("videos",this.handleVideos),H.off("screen_stream",this.handleScreenStream),H.off("screen_sharing",this.handleScreenSharing),H.off("screen_sid",this.handleScreenSharingSid),H.off("facing",this.handleFacing),H.off("end_audio",this.handleAudioEnd),this.stopAudio(),this.stopVideo(),this.stopRealVideo(),this.stopScreenSharing()}},{key:"startAudio",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.audioBusy||null!=this.audioStream){e.next=15;break}return this.audioBusy=!0,e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 5:this.audioStream=e.sent,H.startAudio(this.audioStream),this.audios.add(H.getSid()),this.membersListTrigger+=1,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](2),console.error("Error: ".concat(e.t0));case 14:this.audioBusy=!1;case 15:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"stopAudio",value:function(){null!=this.audioStream&&(this.audioStream.getTracks().forEach((function(e){return e.stop()})),this.audioStream=null,H.endAudio(),this.audios.delete(H.getSid()),this.membersListTrigger+=1)}},{key:"prepareVideo",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.videoBusy||null!=this.videoStream){e.next=14;break}return this.videoBusy=!0,e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:{noiseSuppression:{ideal:!0},width:{ideal:320},height:{ideal:180}},audio:!1});case 5:this.videoStream=e.sent,this.videoDialogVisible?(this.videoStream.addEventListener("inactive",this.stopVideo),this.$refs.selfVideo.srcObject=this.videoStream,this.$refs.selfVideo.addEventListener("playing",(function(){return t.faceDetect(!0)}),{once:!0})):this.stopVideo(),H.on("facing_preview",this.handleFacingPreview),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),console.error("Error: ".concat(e.t0));case 13:this.videoBusy=!1;case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"startVideo",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.realVideoStream=this.videoStream,this.videoStream=null,this.$refs.selfVideo.srcObject=null,this.$refs.realSelfVideo.srcObject=this.realVideoStream,H.startVideo(this.selfLive2DType||"1-1"),this.$refs.realSelfVideo.addEventListener("playing",(function(){return t.faceDetect()}),{once:!0}),this.videoDialogVisible=!1;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"stopVideo",value:function(){null!=this.videoStream&&(this.videoStream.getTracks().forEach((function(e){return e.stop()})),this.$refs.selfVideo.srcObject=null,this.videoStream=null,H.off("facing_preview",this.handleFacingPreview))}},{key:"stopRealVideo",value:function(){null!=this.realVideoStream&&(this.realVideoStream.getTracks().forEach((function(e){return e.stop()})),this.$refs.realSelfVideo.srcObject=null,this.realVideoStream=null,H.endVideo())}},{key:"startScreenSharing",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.screenSharingBusy||null!=this.screenSharingStream){e.next=16;break}return this.screenSharingBusy=!0,e.prev=2,e.next=5,navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1});case 5:this.screenSharingStream=e.sent,this.screenSharingStream.addEventListener("inactive",this.stopScreenSharing),this.$refs.screenVideo.srcObject=this.screenSharingStream,H.startScreenShare(this.screenSharingStream),this.screenSharingSid=H.getSid(),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](2),console.warn(e.t0);case 15:this.screenSharingBusy=!1;case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"stopScreenSharing",value:function(){null!=this.screenSharingStream&&(H.stopScreenShare(),this.screenSharingStream.getTracks().forEach((function(e){return e.stop()})),this.screenSharingStream=null,this.screenSharingSid=null)}},{key:"changeCharacter",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,_e(this.selfLive2DType||void 0);case 2:this.selfLive2DType=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"changeTexture",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Oe(this.selfLive2DType||void 0);case 2:this.selfLive2DType=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"faceDetect",value:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,i,r,a,o=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]&&s[0],n=t?this.$refs.selfVideo:this.$refs.realSelfVideo,null==(t?this.videoStream:this.realVideoStream)){e.next=8;break}return e.next=5,ve["b"](n,new ve["a"]).withFaceLandmarks(!0);case 5:i=e.sent,null!=i?t?H.facingPreview(i.landmarks.positions,i.detection.imageWidth,i.detection.imageHeight):H.facing(i.landmarks.positions,i.detection.imageWidth,i.detection.imageHeight):t&&null!=this.selfLive2DType&&this.$refs.previewLive2D?(r=this.$refs.selfVideoOverlay,a=this.$refs.selfVideo,r.width=a.videoWidth,r.height=a.videoHeight,this.$refs.previewLive2D.setPoint(0,0)):t||H.facing(null),setTimeout((function(){return o.faceDetect(t)}),100);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"refreshLive2d",value:function(e){if(this.$refs["".concat(e,"-live2d")]instanceof Array){var t=this.$refs["".concat(e,"-live2d")][0];t.refresh()}}},{key:"handleFacingPreview",value:function(e){if(null!=this.videoStream){var t=this.$refs.selfVideoOverlay,n=this.$refs.selfVideo;t.width=n.videoWidth,t.height=n.videoHeight;var i=t.getContext("2d");null!=i&&(i.lineWidth=2,i.strokeStyle="rgba(255, 255, 0, 0.5)",i.beginPath(),i.moveTo(e.boxLines[0][0],e.boxLines[0][1]),e.boxLines.forEach((function(e){i.lineTo(e[0],e[1])})),i.lineTo(e.boxLines[5][0],e.boxLines[5][1]),i.moveTo(e.boxLines[1][0],e.boxLines[1][1]),i.lineTo(e.boxLines[6][0],e.boxLines[6][1]),i.moveTo(e.boxLines[2][0],e.boxLines[2][1]),i.lineTo(e.boxLines[7][0],e.boxLines[7][1]),i.moveTo(e.boxLines[3][0],e.boxLines[3][1]),i.lineTo(e.boxLines[8][0],e.boxLines[8][1]),i.closePath(),i.stroke()),null!=this.selfLive2DType&&this.$refs.previewLive2D&&this.$refs.previewLive2D.setPoint(e.poseAlt.x,e.poseAlt.y)}}},{key:"handleAudioStart",value:function(){var e=this,t=H.getAudioBuffer();t.forEach((function(t,n){var i=e.$refs["".concat(n,"-audio")];null!=i&&(i[0].srcObject=t,e.audios.add(n),e.membersListTrigger+=1)})),t.clear()}},{key:"handleAudioEnd",value:function(e){this.audios.delete(e.sid),this.membersListTrigger+=1}},{key:"handleFacing",value:function(e){if(null!=this.realVideoStream&&this.$refs["".concat(e.sid,"-live2d")]instanceof Array){var t=this.$refs["".concat(e.sid,"-live2d")][0];t.setPoint(e.poseAlt.x,e.poseAlt.y),t.setActive(e.active)}}},{key:"handleMembers",value:function(){this.members=H.getMembers(),this.membersListTrigger+=1}},{key:"handleVideos",value:function(){this.videos=H.getVideos(),this.membersListTrigger+=1}},{key:"handleScreenStream",value:function(){this.$refs.screenVideo.srcObject=H.getScreenStream()}},{key:"handleScreenSharing",value:function(){this.screenSharing=H.isScreenSharing(),this.screenSharing||(this.screenSharingSid=null)}},{key:"handleScreenSharingSid",value:function(){this.screenSharingSid=H.getScreenSid()}},{key:"membersList",get:function(){var e=this,t=[];return this.members.forEach((function(n,i){var r=e.videos.get(i)||null,a=e.audios.has(i);t.push({sid:i,nickName:n,audio:a,character:r,color:e.screenSharingSid===i?"green darken-3":null,colorDark:e.screenSharingSid===i?"green darken-4":"grey darken-3"})})),this.membersListTrigger&&t}}]),n}(i["a"]);Object(l["c"])([Object(fe["b"])("navValue")],Te.prototype,"onNavigationValueChanged",null),Object(l["c"])([Object(fe["b"])("videoDialogVisible")],Te.prototype,"onVideoDialogVisibleChanged",null),Te=Object(l["c"])([Object(u["b"])({components:{Live2D:xe}})],Te);var De=Te,Le=De,$e=(n("7a4c"),n("8212")),Re=n("b81c"),Ae=n("99d9"),Ee=n("cc20"),Be=n("62ad"),Me=n("169a"),Ne=n("6b53"),Pe=n("2fa4"),Ie=Object(v["a"])(Le,ue,de,!1,null,null,null),Fe=Ie.exports;K()(Ie,{VApp:Q["a"],VAvatar:$e["a"],VBottomNavigation:Re["a"],VBtn:Y["a"],VCard:Z["a"],VCardActions:Ae["a"],VCardText:Ae["b"],VCardTitle:Ae["c"],VChip:Ee["a"],VCol:Be["a"],VContent:ee["a"],VDialog:Me["a"],VIcon:ne["a"],VResponsive:Ne["a"],VRow:ie["a"],VSpacer:Pe["a"]}),i["a"].use(b["a"]);var ze=[{path:"/",name:"Home",redirect:"/join"},{path:"/new",name:"New",component:le},{path:"/join",name:"Join",component:le},{path:"/:id",name:"Classroom",component:Fe}],We=new b["a"]({routes:ze}),He=We,Ue=n("f309");i["a"].use(Ue["a"]);var qe=new Ue["a"]({theme:{dark:!0,options:{customProperties:!0}}});document.oncontextmenu=function(){return!1},new i["a"]({router:He,vuetify:qe,render:function(e){return e(m)}}).$mount("#app")}});
//# sourceMappingURL=app.01671e49.js.map